%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Head matter - can we try to be consistent on
% included packages
\documentclass[xcolor=table	]{beamer}
\mode<presentation>
{\usetheme{default}
 \usecolortheme{default}
 \usefonttheme{default}
 \setbeamertemplate{navigation symbols}{}
 \setbeamertemplate{caption}[numbered]} 

\usepackage{syntax}
\usetheme[secheader]{Boadilla}

% Add Better I for interpretation 
\usepackage{mathrsfs}
\usepackage{mathtools}
\DeclarePairedDelimiter\ev{\langle}{\rangle}%

\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\ol}{\overline}

\usepackage{array}
%\newtheorem{lemma}{Lemma}
\usepackage[customcolors]{hf-tikz}
\usepackage{tikz}

\usepackage{xcolor}% http://ctan.org/pkg/xcol
\definecolor{OliveGreen}{rgb}{0.2,0.7,0.2}
\definecolor{airforceblue}{rgb}{0.36, 0.54, 0.66}
\definecolor{awesome}{rgb}{1.0, 0.13, 0.32}
\definecolor{brilliantrose}{rgb}{1.0, 0.33, 0.64}
\definecolor{charcoal}{rgb}{0.21, 0.27, 0.31}
\definecolor{britishracinggreen}{rgb}{0.0, 0.26, 0.15}
\definecolor{darkgreen}{rgb}{0.0, 0.2, 0.13}
\definecolor{darkpastelgreen}{rgb}{0.01, 0.75, 0.24}
\definecolor{lavenderindigo}{rgb}{0.58, 0.34, 0.92}
\definecolor{ultramarine}{RGB}{0,32,96}
\definecolor{mycolor}{rgb}{.5,.05,.05}
\definecolor{britishracinggreen}{rgb}{0.0, 0.26, 0.15}
\definecolor{burntorange}{rgb}{0.8, 0.33, 0.0}
\definecolor{coolblack}{rgb}{0.0, 0.18, 0.39}
\definecolor{harvestgold}{rgb}{0.85, 0.57, 0.0}
\definecolor{harvardcrimson}{rgb}{0.79, 0.0, 0.09}

\definecolor{wrongultramarine}{rgb}{0.07, 0.04, 0.56}

 \setbeamertemplate{footline}{%
   \raisebox{5pt}{\makebox[\paperwidth]{\hfill\makebox[10pt]{\scriptsize\insertframenumber}}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Formatting for title page
\title[QBF]{Autarkies for DQCNF}
\author{Oliver Kullmann \inst{1} \and \textbf{Ankit Shukla} \inst{2}}
\institute{\inst{1} Swansea university \inst{2} JKU, Austria}
%{\large International Workshop on QBFs and Beyond}
%\date{10 September 18}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\begin{frame}
  \titlepage
\end{frame}

\begin{frame}{TODO}
 Later then one defines "autarkies" in general,
 
 and E1,A1 etc.
 
 Plus the main lemma, 
 
 the SAT-equivalence, 
 
 and explaining "autarky systems" and 
 
 confluence.
\end{frame}

%\begin{frame}{DQCNF}
%Dependency Quantified Boolean Formulas (DQBF) extend QBF \\
%with \textbf{Henkin quantifiers}, which allow for non-linear dependencies \\ between the quantified variables. 
%\hfsetfillcolor{green!50}
%\hfsetbordercolor{green!50!black}
%\begin{equation}\label{e:barwq3}
%  \begin{split}
%	\tikzmarkin{c}(0.05,-0.6)(-0.05,0.65)F \, = \, \forall u1, u2 \, \exists e1(u1), e2(u1, u2), e3(u1, u2) . F_0\\
%	F_0 \, = \,(u1 \lor e1) \land (u2 \lor e2) \land (u1 \lor u2 \lor e3)
%	\tikzmarkend{c}
%\end{split}
%\end{equation}	
%\begin{equation}
%\begin{split}
% \overbrace{\tikz[baseline]{
%		\node[fill=yellow!30,anchor=base] (t1)
%		{$\forall x_1, x_2 \, \exists y_1(x_1), y_2(x_1, x_2)$};
%}}^{\displaystyle Dep. \, quantifier \, prefix} : \underbrace{\tikz[baseline]{
%		\node[fill=green!30,anchor=base] (t1)
%		{$(x_1 \lor y_1) \land (x_2 \lor y_2 \lor \neg y_1)$};
%}}^{\displaystyle CNF \, formula}
%\end{split}
%\end{equation}
%
%
%\begin{alertblock}{Dependency set}
% $y_1 \to \{x_1 \}$
%
% $y_2 \to  \{ x_1, x_2 \}$
%\end{alertblock}
%  
%\end{frame}

\begin{frame}{Solve DQBF: SAT or UNSAT?}
%\vspace{0.2cm
\begin{alertblock}{1. DQCNF formula:}
	{		
		$ \forall x, y \, \exists a(x) \, \exists  b(y) \, \exists c(x,y) \, \exists d(x) \, \exists e(y) :
		   \{a,b,x\}, \{\ol{a},b,\ol{x}\}, \{a,\ol{b},y\}, \{\ol{a},\ol{b},\ol{y}\}  \\
		   \{c,x,y\}, \{c,\ol{x},\ol{y}, a\}, \{\ol{c},x,\ol{y}\}, \{\ol{c},\ol{x},\ol{y}\} \\
		   \{d,e,x\}, \{\ol{d},e,\ol{x}, c\} \{d,\ol{e},y\}, \{\ol{d},\ol{e},\ol{y}\} $
	}
\end{alertblock}
%\begin{exampleblock}{Solve the DCNF}
%	{
%		\begin{enumerate}
%			\item Pick $y_2$: $\overline{y_2}$ is pure \\
%			 $y_2 \rightarrow 0$ (removing the third clause).
%			\item Pick $y_3$: $y_3 \rightarrow x_1$  \\
%			removing the fourth and fifth clauses.	
%		%	Both these autarkies are also $Eaut_1$-autarkies.
%		\end{enumerate}
%	}
%\end{exampleblock}
%Reduction result: \\
%
%\forall x_1,x_2,x_3 \exists y_1(x_1,x_2) : (y_1 \vee x_1) \wedge (\overline{y_1} \vee x_2)$
%\textbf{lean kernel} of the original formula.
\end{frame}

%\begin{frame}{Autarkies for DQBF}
%``Autarkies" are some form of redundancies in CNFs, \newline
%with good theoretical properties \newline
%
%We present Autarky-system to determine these redundancies for DQBF \newline 
%
%%A1, E1, A1 + E1 \newline
%
%Present complete translation using an example 
%
%\end{frame}

%\begin{frame}{Autarkies}
%
%Autarkies for SAT are partial assignments for boolean CNF, \newline 
% which either satisfy a clause or leave it untouched. \newline
% 
%$F$ =  $(a) \land (a \lor b)$ \newline
% 
%Nontrivial Autarky:  $<b \to 1>$ \newline 
%
%Reduced formula: \newline 
%$F^{\prime}$ =  $(a)$
% 
%\end{frame}

\begin{frame}{Autarkies}
An autarky for a clause-set $F$ is a partial assignment $\phi$ which satisfies every clause $C \in F$ it touches. \newline

%($var(\phi) \, \cap \, var(C)$ $\neq$ $\phi$)
An autarky $\phi$ for $F$ is \textbf{trivial} if $var(\phi) \, \cap \, var(C)$ = $\phi$ \newline

A \textbf{lean} clause-set is a clause-set $F$ which has
only the trivial autarky. \newline 

The class of all lean clause-sets is $lean$.

\end{frame}


\begin{frame}{Autarkies ...}

Applications: 
\begin{enumerate}
    \item Study of Unsatisfiability
    \item Pre-processing 
    \item Inprocessing
\end{enumerate}

 \begin{exampleblock}{Challenge}
 Finding an autarky for DQCNF is as hard as finding a satisfying assignment.
\end{exampleblock}
    
  \begin{alertblock}{Our solution: Autarky Systems}
  \begin{itemize}
      \item restricting the range of autarkies to a more feasible domain
      \item maintain the good general properties of arbitrary autarkies
  \end{itemize}
 
  \end{alertblock}

\end{frame}

\begin{frame}{Basic Lemmas}
 \begin{lemma}[1]
   $\Phi$ ∗ $F$ is satisfiability-equivalent to $F$ for an autarky $\Phi$ of $F$.
 \end{lemma}
 
  \begin{lemma}[2]
  The composition of two autarkies is again an autarky.
 \end{lemma}
 
  \begin{lemma}[3]
   Given a DQCNF $F$, the largest lean sub-DQCNF $N_{a} (F)$ is also obtained by applying autarky-reduction to $F$ as long as possible.
 \end{lemma}
 
\end{frame}


\begin{frame}{Autarky systems}

Allow restricted notions of autarkies. \newline
\begin{itemize}
    \item For a DQCNF $F$ we write $Auk(F)$ for the set of all autarkies.  
    \item An autarky system $A$ allows to consider subsets $A(F) \subseteq Auk(F)$.
\end{itemize}

\vspace{0.5cm}

Required conditions for an autarky system:
\begin{enumerate}
    \item DQCNF $F$ and $\phi$, $\psi \in A(F)$ it
must always hold $\phi \circ \psi \in A(F)$ (closure under composition).

    \item DQCNF $F \subseteq F_0$ it must always hold $A(F_0) \subseteq A(F)$ (removal of clauses does not remove A-autarkies).
\end{enumerate}

A-satisfiability means satisfiability by a series of A-
autarkies. \newline

A-leanness means there there are no nontrivial A-autarkies.
\end{frame}

\begin{frame}{Additional concepts}

Fundamental conditions on the Autarky system:

\begin{enumerate}
    \item standardised variables not actually occurring are irrelevant.
    \item $\bot$-invariant universal clauses (only having universal variables) are irrelevant.
    \item invariant under variable elimination removing (existential) variables from
the clauses does not affect autarkies of A which do not use these variables.
    \item invariant under renaming renaming variables (existential or universal) is respected by the autarky system.
\end{enumerate}
\end{frame}

\begin{frame}{A- and E-systems}
Consider a DQCNF $F$ and $k \geq 0$: \newline
\begin{enumerate}
    \item An $Ak$- autarky for $F$ is an autarky such that all boolean functions assigned depend essentially on at most $k$ variables.
    \item An $Ek$-autarky is an autarky assigns at most $k$ (existential) variables. 
\end{enumerate}

\vspace{0.4cm}

  $A0$ and $A1$ allow the boolean functions to essentially \newline  
  depend on 0 resp. 1 universal variable. \newline 

  $E1$ only uses one existential variable. \newline 
  
  We have considered three Autarky Systems \newline 
  \textbf{$A1$, $E1$, $A1 + E1$}.

\end{frame}
\begin{frame}{Autarky reduction}
 \begin{exampleblock}{Example}
    {
  $ F := (\{3,4\}, \{1,2\}, \{\{-1,2\},\{2,-3,-4\}\}, \{(1,\{3\}), (2,\{3,4\})\})$    
    }
    \end{exampleblock}

\begin{exampleblock}{A DQDIMACS code is}
    {
p cnf 4 2 \\
a 3 4 0 \\
e 2 0 \\
d 1 3 0 \\
-1 2 0 \\
2 -3 -4 0 \\       
    }
    \end{exampleblock}
    \vspace{0.2cm}
\end{frame}

\begin{frame}{Translation to SAT: Finding A1 via compilation}
\begin{enumerate}
    \item \textbf{Selected (boolean) functions}: restrict to some “interesting” selection \textbf{s(v)} $\subseteq$ $BF^{D^v}$ , and treat the elements of s(v) as the possible values of v. \newline 
    
    \item \textbf{Admissible partial assignment:} For each $C \in F$ , compile all possibilities for admissible partial satisfying assignments for C into some CNF-representation \textbf{P(C)}.
\end{enumerate}

\end{frame}

\begin{frame}{Selected boolean functions}
Translation \textbf{t} chooses for each $v \in E$ and $f \in s(v)$ a distinct new \textbf{bf-variable} \newline 
  \textbf{t(v,f)} $\in$  \textbf{Va}   (``true'' iff $f$ is chosen for $v$)
  
\begin{equation}
  \bigwedge_{f, f' \in s(v), f \ne f'} \overline{t(v,f)} \,\, \lor \,\, \overline{t(v,f')}.
 \end{equation}
 
\begin{exampleblock}{$s(v)$ all at-most-one-variable-bfs}
e 2 0 \\
d 1 3 0 \newline 

 % $\abs{s(1)} = 4$ and $\abs{s(2)} = 6$; to list these $4+6 = 10$
    t(1,bf(0)), t(1,bf(1)), t(1,3), t(1,-3) \newline 

    t(2,bf(0)), t(2,bf(1)), t(2,3), t(2,-3), t(2,4), t(2,-4)
 
 \end{exampleblock}
\end{frame}

\begin{frame}{Admissible partial assignment}
    %For the minimal satisfying clause-assignments we have 
    Types of minimal possibilities for $C$ to become a tautology
    \begin{enumerate}
        \item some existential $y \in C$ is set to 1;
        \item some existential $y \in C$ there is a universal $x \in C$ with $var(x) \in  D(var(y))$, and y is set to x;
        \item for some existential $y, y' \in C$, $y, y'$ , there is a universal $x \in D(var(y))$, and $y$ is set to $x$ and $y'$ to $x$. 
    \end{enumerate}

\begin{exampleblock}{The admissible autarkies}
-1 2 0 \\
2 -3 -4 0 \newline 

$S(\{-1,2 \}) = \{ \ev{1 \to bf(0)}, \ev{2 \to bf(1)}, \ev{1 \to \pm 3, 2 \to  \mp 3} \} $ \newline 

$S(\{2,-3,-4\}) = \{ \ev{2 \to bf(1)}, \ev{2 \to 3}, \ev{2 \to 4} \}$
\end{exampleblock}

\end{frame}

\begin{frame}{Frame Title}
We choose distinct new pa-variables
\[ t(\phi) \in VA 
\]
for $\phi \in \bigcup\limits_{C \in F} S(C)$ (`` true" iff $\phi$ is activated).

\begin{equation}
t(\phi) \iff t(v, \phi(v))
\end{equation}
\end{frame}


\begin{frame}{Frame Title}
We choose furthermore distinct new clause-selector-variables
\[ t(C) \in VA \]
(``true” if C is satisfied)

for each $C \in F$ the clauses
\begin{equation}
    \overline{t(C)} \vee \bigvee_{\phi \in S(C)} t(\phi)
\end{equation}

\begin{equation}
    \bigwedge_{v \in var(C) \cap E} \bigwedge_{f \in s(v)} t(C) \bigvee \overline{t(v,f)}
\end{equation}
\end{frame}

\begin{frame}{Frame Title}
    The existence of a non-trivial autarky 
  \begin{equation}
    \bigvee_{C \in F} t(C)
  \end{equation}
\end{frame}

\begin{frame}{Results}
334 instances in the DQBF track of QBFEVAL'18 

\begin{itemize}
    \item 330 instances are E1+A1-lean (have no non-trivial E1- or A1-autarky). 
    \item From the remaining 4 instances, all are E1-lean, one is A1-satisfiable, 
    \item one is E1+A1-satisfiable, 
    \item the remaining two instances are not E1+A1-satisfiable,
    \item but allow A1-autarkies eliminating in both cases around 80 of variables
and clauses (while adding E1 does not change this).
\end{itemize}

\end{frame}

%\begin{frame}{Results}
%\begin{table}[t]
%  \centering
%\adjustbox{max height=\dimexpr\textheight-5.5cm\relax,
%           max width=\textwidth}{
%\begin{tabular}[t]{|c|c|c|c|c|}\hline
%  
%   {\multirow{2}{*} {\textbf{Solver}}}  & {\multirow{2}{*} {\textbf{Solved instance}}} &  \multicolumn{2}{c|}{\textbf{Instance}} & {\multirow{2}{*} {\textbf{Time}}} \\\cline{3-4}
%  
%   %{} & \multicolumn{2}{c|}{\textbf{2-connected} } & \multicolumn{2}{c|}{\textbf{3-connected} } & \multicolumn{2}{c|}
%   
%  % \\\cline{2-5}
%    {} & {} & {\textbf{Unsat}} & {\textbf{Sat}} & {} \\\hline
%     Rev-Qfun & 220 & 145 & 75 & 572K \\\hline 
%     GhostQ & 194 & 120 & 74 & 617K \\\hline 
%     CAQE & 170 & 128 & 42 & 656K \\\hline 
%     \cellcolor{blue!25}\textsc{RAReQS} & {\color{blue}{\textbf{167}}} & \textbf{133} & 34 & 660K \\\hline 
%     DepQBF & 167 & 121 & 46 & 666K \\\hline 
%    \cellcolor{red!25}\textsc{Heretic} & {\color{red}{163}} &\textbf{ 133} & 30 & 664K \\\hline 
%    \cellcolor{green!25} \textsc{Ijtihad} & {\color{britishracinggreen}{150}} & 127 & 23 & 684K \\\hline 
%%Qute 130 91 39 720K
%%QESTO 109 86 23 761K
%%DynQBF 72 38 34 826K
%%QSTS 152 116 36 687K   
%  \end{tabular}}
% \caption{Original Instances (time include timeouts).}
%  \label{tab:qf-grabh}
%\end{table}
%\end{frame}

\begin{frame}{Conclusion}
\begin{itemize}
\item Autarky theory for DQBF.
\item Three Autarky systems A1, E1, A1+E1
\item A SAT translation 
\end{itemize}
\vspace{1cm}
\Large
Dankeschön!
\end{frame}

\end{document}
